---
article: Familiars
authors: benevolusgoat
blurb: Learn how to create custom familiars.
comments: true
tags:
    - Tutorial
    - Beginner friendly
    - Lua
    - XML
    - Repentance
    - Repentance+
---

{% include-markdown "hidden/crash_course_toc.md" start="<!-- start -->" end="<!-- end -->" %}

Familiars are small companions Isaac obtains, normally through passive items, that follow and assist Isaac. This tutorial will cover the basics of creating a familiar.

## Video tutorial

Although the video tutorial covers how to create a shooter familiar, this tutorial will only cover the essentials to creating an item that summons a familiar. A more advanced tutorial on creating different familiar variants can be found here (article not made yet!).
[![Familiars | Youtube Tutorial](https://img.youtube.com/vi/kJoTeVR8tAA/0.jpg)](https://youtu.be/kJoTeVR8tAA "Video tutorial")

## Creating your familiar

Creating your familiar involves entries within two different files: [items.xml](passive_item.md) and [entities2.xml](entity_basics.md). Adjustments are needed to cater these entries towards familiars specifically.

**items.xml**

When defining your item, instead of the `passive` tag, use `familiar`. This will categorize the item as a familiar item. Normally, an item that summons a familiar should have `cache="familiars"` present, but items that are defined as a familiar item will automatically handle this.

This `items.xml` entry will add an item named "Friend Frankie", a Quality 1 item, with four tags present.

- `baby` will have the item contribute to the [Conjoined](https://bindingofisaacrebirth.wiki.gg/wiki/Conjoined) transformation
- `offensive` makes this item available to Tainted Lost
- `summonable` allows the item to be summoned by Lemegeton
- `monstermanual` allows the item's familiar to be summoned by Monster Manual

```XML
<items gfxroot="gfx/items/" version="1">
        <familiar name="Friend Frankie" description="Friends 'till the end" quality="1" tags="baby offensive summonable monstermanual" />
</items>
```

**entities2.xml**

In conjunction with your item, the familiar must exist as an entity. The `id` variable must be equal to `3` to define it as a familiar.

This `entities2.xml` entry will add a familiar entity, also aptly named "Friend Frankie", with some simple attributes. Note that the `items.xml` entry and the `entities2.xml` entry do NOT need to have the same name. It is only for convenience.

For the variant, it can be any arbitrary value not taken up by an existing vanilla familiar. Available variants are `131`-`199`, `244`-`899`, and `901`-`4095`. More information on why the variant must be defined within these boundaries can be found [here](entity_basics.md#what-to-set-for-idvariantsubtype).

It has one tag named `cansacrifice`, meaning the familiar can be removed by [Sacrificial Altar](https://bindingofisaacrebirth.wiki.gg/wiki/Sacrificial_Altar).

```XML
<entities anm2root="gfx/" version="5">
    <entity name="Friend Frankie" id="3" variant="508" anm2path="familiar_friend_frankie.anm2"
    tags="cansacrifice" shadowSize="11" friction="1" />
</entities>
```

## Linking the familiar to the item

Although you have created your item and your entity, there is nothing that automatically links the two together. This must be done manually through Lua code through the use of the [MC_EVALUATE_CACHE](https://wofsauge.github.io/IsaacDocs/rep/enums/ModCallbacks.html#mc_evaluate_cache) callback.

First, setting up the `main.lua` file at the root of your mod folder, fetching the necessary variables needed and the callback:

```Lua
local mod = RegisterMod("My Mod", 1)

--Obtain the ID automatically generated by the game for both your item and your entity.
--We will be storing other variables here that do not change, named constants, later on.
local ITEM_ID = Isaac.GetItemIdByName("Friend Frankie")
local FAMILIAR_VARIANT = Isaac.GetEntityVariantByName("Friend Frankie")

---The player who's cache is being evaluated is the first argument passed into the function
function mod:EvaluateCache(player)

end

--MC_EVALUATE_CACHE allows an optional argument where you can define a CacheFlag, which will make the callback only run for that flag.
--In this instance, the function will only ever run for the CACHE_FAMILIARS CacheFlag.
mod:AddCallback(ModCallbacks.MC_EVALUATE_CACHE, mod.EvaluateCache, CacheFlag.CACHE_FAMILIARS)
```

Next, to fill the function. Checking what familiars should spawn, adding familiars, or removing them is all handled through the [EntityPlayer:CheckFamiliar](https://wofsauge.github.io/IsaacDocs/rep/EntityPlayer.html#checkfamiliar) function. It is not 100% required, but is convenient for most use-cases. The function takes the following arguments:

- What familiar variant to spawn.
- How many familiars are expected to be present.
- An [RNG](https://wofsauge.github.io/IsaacDocs/rep/RNG.html) object for determining its InitSeed.
- An [ItemConfigItem](https://wofsauge.github.io/IsaacDocs/rep/ItemConfig_Item.html) object for linking an item to the spawned familiar. This is optional to include, but will be used for this tutorial.
- An integer to spawn a specific `SubType` of familiar. This is optional, and by default spawns familiars with a subtype of `0`.

We already have the familiar variant stored earlier in the lua file. For the number of familiars to spawn, this can be any number you'd like, but the most common example is how many copies of the item Isaac has combined with the number of [TemporaryEffects](../general/temporary_effects.md) of the item. The purpose of the latter is for items such as Box of Friends, where it will add a `TemporaryEffect` of your familiar item to spawn a copy of your familiar without needing to own the item.

For the RNG, it's a bit more complicated. The `RNG` object passed into `CheckFamiliar` is used for the familiar's InitSeed, which is often used by modders as a unique identifier for each individual familiar. `CheckFamiliar` is bugged in the sense that it will not advance the `RNG` object's seed, meaning multiple of the same familiar would spawn with the exact same InitSeed, potentially disrupting other mods. The only reliable way to fix this is to pass a completely random RNG seed every time the function is called. This won't cause any issues as, once a familiar is spawned, it will keep its InitSeed until it is removed from the player entirely.

???- note "rng:Next()"
	Calling `:Next()` on a persistent RNG such as `EntityPlayer:GetCollectibleRNG` will technically resolve the aforementioned issue, however if more than one familiar is added simultaneously, it will "invisibly" advance the RNG object for the other familiars after the first one. This can be accomplished with adding more than one TemporaryEffect for your familiar's item at the same time. Paired with the bug of it not updating the passed RNG object, this will make it so the next time a new version of your familiar spawns, it will have the same InitSeed as one of the extra copies.

```Lua
local mod = RegisterMod("My Mod", 1)

local ITEM_ID = Isaac.GetItemIdByName("Friend Frankie")
local FAMILIAR_VARIANT = Isaac.GetEntityVariantByName("Friend Frankie")
--Storing constant variable here for convenience
local RNG_SHIFT_INDEX = 35
--Access the ItemConfigClass
local itemConfig = Isaac.GetItemConfig()
--Obtain the ItemConfigItem object for our item
local CONFIG_FRANKIE = itemConfig:GetCollectible(ITEM_ID)

function mod:EvaluateCache(player)
	--Access the TemporaryEffects class
	local effects = player:GetEffects()
	--Get how many familiars should be spawned
	local count = player:GetCollectibleNum(ITEM_ID) + effects:GetCollectibleEffectNum(ITEM_ID)
	--Create a new RNG object
	local rng = RNG()
	--Get a random seed via Random(), which returns any number from 0 to 2^32, inclusive
	--RNG objects with a seed of 0 will crash the game, so we use math.max will ensure its always at least 1 or above.
	local seed = math.max(Random(), 1)
	--When setting a seed, you must set the "Shift Index", which essentially determines the sequence of numbers the RNG object will have.
	--The default Shift Index, revealed by one of the game's developers, is 35.
	rng:SetSeed(seed, RNG_SHIFT_INDEX)

	player:CheckFamiliar(FAMILIAR_VARIANT, count, rng, CONFIG_FRANKIE)
end

mod:AddCallback(ModCallbacks.MC_EVALUATE_CACHE, mod.EvaluateCache, CacheFlag.CACHE_FAMILIARS)
```

With that, your familiar should now spawn when collecting your item and through other scenarios such as Box of Friends! For checking out what more can be done with a familiar, see the [EntityFamiliar](https://wofsauge.github.io/IsaacDocs/rep/EntityFamiliar.html) docs page, or read the article on familiar variations (article not made yet!).