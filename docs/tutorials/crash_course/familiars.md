---
article: Familiars
authors: benevolusgoat
blurb: Learn how to create custom familiars.
comments: true
tags:
    - Tutorial
    - Beginner friendly
    - Lua
    - XML
    - Repentance
    - Repentance+
---

{% include-markdown "hidden/crash_course_toc.md" start="<!-- start -->" end="<!-- end -->" %}

Familiars are small companions Isaac obtains, normally through passive items, that follow and assist Isaac. This tutorial will cover the basics of creating a familiar that can shoot tears.

## Video tutorial

[![Familiars | Youtube Tutorial](https://img.youtube.com/vi/kJoTeVR8tAA/0.jpg)](https://youtu.be/kJoTeVR8tAA "Video tutorial")

## Creating your familiar

Creating your familiar involves entries within two different files: [items.xml](passive_item.md) and [entities2.xml](entity_basics.md). Adjustments are needed to cater these entries towards familiars specifically.

**items.xml**

When defining your item, instead of the `passive` tag, use `familiar`. This will categorize the item as a familiar item. Normally, an item that summons a familiar should have `cache="familiars"` present, but items that are defined as a familiar item will automatically handle this.

This `items.xml` entry will add an item named "Friend Frankie", a Quality 1 item, with four tags present.

- `baby` will have the item contribute to the [Conjoined](https://bindingofisaacrebirth.wiki.gg/wiki/Conjoined) transformation
- `offensive` makes this item available to Tainted Lost
- `summonable` allows the item to be summoned by Lemegeton
- `monstermanual` allows the item's familiar to be summoned by Monster Manual

```XML
<items gfxroot="gfx/items/" version="1">
        <familiar name="Friend Frankie" description="Friends 'till the end" quality="1" tags="baby offensive summonable monstermanual" />
</items>
```

**entities2.xml**

In conjunction with your item, the familiar must exist as an entity. The `id` variable must be equal to `3` to define it as a familiar.

This `entities2.xml` entry will add a familiar entity, also aptly named "Friend Frankie", with some simple attributes. Note that the `items.xml` entry and the `entities2.xml` entry do not need to have the same name; it is only for convenience.

For the variant, it can be any arbitrary value not taken up by an existing vanilla familiar. Available variants are `131`-`199`, `244`-`899`, and `901`-`4095`. More information on why the variant must be defined within these boundaries can be found [here](entity_basics.md#what-to-set-for-idvariantsubtype).

```XML
<entities anm2root="gfx/" version="5">
    <entity name="Friend Frankie" id="3" variant="508" anm2path="familiar_friend_frankie.anm2"
    tags="cansacrifice" shadowSize="11" friction="1" />
</entities>
```

### familiar-relevant tags

The `tags` variable has several options available that are exclusive to or relevant for familiars.

???- info "`tags` list"
	| Tag-Name | Suffix |
	|:--|:--|
	| cansacrifice | Marks familiars that [Sacrificial Altar](https://bindingofisaacrebirth.wiki.gg/wiki/Sacrificial_Altar) can be used on. |
	| fly | Increases familiar size and damage if their player has Hive Mind, similarly to [BFFS!](https://bindingofisaacrebirth.wiki.gg/wiki/BFFS!). |
	| spider | Increases familiar size and damage if their player has Hive Mind, similarly to [BFFS!](https://bindingofisaacrebirth.wiki.gg/wiki/BFFS!). |

:modding-repentogon: REPENTOGON also has a `customtags` variable intended to expand upon the `tags` list.

???- info "`customtags` list"
	| Tag-Name | Suffix |
	|:--|:--|
	| familiarignorebffs | The [BFFS!](https://bindingofisaacrebirth.wiki.gg/wiki/BFFS!) item will no longer affect this familiar. |
	| familiarcantakedamage | Familiars with `baseHP` above `0` will be able to take damage and die, such as from enemy contact, lasers or explosions. Note that they will only take damage from projectiles if they also have the `familiarblockprojectiles` tag. |
	| familiarblockprojectiles | The familiar automatically destroys enemy projectiles on contact. |
	| nocharm | Makes the familiar not be charmed by [Siren](https://bindingofisaacrebirth.wiki.gg/wiki/The_Siren). |

## Linking the familiar to the item

Although you have created your item and your entity, there is nothing that automatically links the two together. This must be done manually through Lua code through the use of the [MC_EVALUATE_CACHE](https://wofsauge.github.io/IsaacDocs/rep/enums/ModCallbacks.html#mc_evaluate_cache) callback.

First, setting up the `main.lua` file at the root of your mod folder, fetching the necessary variables needed and the callback:

```Lua
local mod = RegisterMod("My Mod", 1)

--Obtain the ID automatically generated by the game for both your item and your entity.
--We will be storing other variables here that do not change, named constants, later on.
local ITEM_ID = Isaac.GetItemIdByName("Friend Frankie")
local FAMILIAR_VARIANT = Isaac.GetEntityVariantByName("Friend Frankie")

---The player who's cache is being evaluated is the first argument passed into the function
function mod:EvaluateCache(player)

end

--MC_EVALUATE_CACHE allows an optional argument where you can define a CacheFlag, which will make the callback only run for that flag.
--In this instance, the function will only ever run for the CACHE_FAMILIARS CacheFlag.
mod:AddCallback(ModCallbacks.MC_EVALUATE_CACHE, mod.EvaluateCache, CacheFlag.CACHE_FAMILIARS)
```

Next, to fill the function. Checking what familiars should spawn, adding familiars, or removing them is all handled through the [EntityPlayer:CheckFamiliar](https://wofsauge.github.io/IsaacDocs/rep/EntityPlayer.html#checkfamiliar) function. It is not 100% required, but is convenient for most use-cases. The function takes the following arguments:

- What familiar variant to spawn.
- How many familiars are expected to be present.
- An [RNG](https://wofsauge.github.io/IsaacDocs/rep/RNG.html) object for determining its InitSeed.
- An [ItemConfigItem](https://wofsauge.github.io/IsaacDocs/rep/ItemConfig_Item.html) object for linking an item to the spawned familiar. This is optional to include, but will be used for this tutorial.
- An integer to spawn a specific `SubType` of familiar. This is optional, and by default spawns familiars with a subtype of `0`.

We already have the familiar variant stored earlier in the lua file. For the number of familiars to spawn, this can be any number you'd like, but the most common example is how many copies of the item Isaac has combined with the number of [TemporaryEffects](../general/temporary_effects.md) of the item. The purpose of the latter is for items such as Box of Friends, where it will add a `TemporaryEffect` of your familiar item to spawn a copy of your familiar without needing to own the item.

For the RNG, it's a bit more complicated. The `RNG` object passed into `CheckFamiliar` is used for the familiar's InitSeed, which is often used by modders as a unique identifier for each individual familiar. `CheckFamiliar` is bugged in the sense that it will not advance the `RNG` object's seed, meaning multiple of the same familiar would spawn with the exact same InitSeed, potentially disrupting other mods. The only reliable way to fix this is to pass a completely random RNG seed every time the function is called. This won't cause any issues as, once a familiar is spawned, it will keep its InitSeed until it is removed from the player entirely.

???- note "rng:Next()"
	Calling `:Next()` on a persistent RNG such as `EntityPlayer:GetCollectibleRNG` will technically resolve the aforementioned issue, however if more than one familiar is added simultaneously, it will "invisibly" advance the RNG object for the other familiars after the first one. This can be accomplished with adding more than one TemporaryEffect for your familiar's item at the same time. Paired with the bug of it not updating the passed RNG object, this will make it so the next time a new version of your familiar spawns, it will have the same InitSeed as one of the extra copies.

```Lua
local mod = RegisterMod("My Mod", 1)

local ITEM_ID = Isaac.GetItemIdByName("Friend Frankie")
local FAMILIAR_VARIANT = Isaac.GetEntityVariantByName("Friend Frankie")
--Storing constant variable here for convenience
local RNG_SHIFT_INDEX = 35
--Access the ItemConfigClass
local itemConfig = Isaac.GetItemConfig()
--Obtain the ItemConfigItem object for our item
local CONFIG_FRANKIE = itemConfig:GetCollectible(ITEM_ID)

function mod:EvaluateCache(player)
	--Access the TemporaryEffects class
	local effects = player:GetEffects()
	--Get how many familiars should be spawned
	local count = player:GetCollectibleNum(ITEM_ID) + effects:GetCollectibleEffectNum(ITEM_ID)
	--Create a new RNG object
	local rng = RNG()
	--Get a random seed via Random(), which returns any number from 0 to 2^32, inclusive
	--RNG objects with a seed of 0 will crash the game, so we use math.max will ensure its always at least 1 or above.
	local seed = math.max(Random(), 1)
	--When setting a seed, you must set the "Shift Index", which essentially determines the sequence of numbers the RNG object will have.
	--The default Shift Index, revealed by one of the game's developers, is 35.
	rng:SetSeed(seed, RNG_SHIFT_INDEX)

	player:CheckFamiliar(FAMILIAR_VARIANT, count, rng, CONFIG_FRANKIE)
end
count
mod:AddCallback(ModCallbacks.MC_EVALUATE_CACHE, mod.EvaluateCache, CacheFlag.CACHE_FAMILIARS)
```

With that, your familiar should now spawn when collecting your item and through other scenarios such as Box of Friends!

## Creating a shooter familiar

Your familiar exists, but at the current moment will do nothing when spawned in. Let's have it follow the player.

This code will automatically make the familiar a "follower" familiar, being inserted into the familiar line and following the player/the familiar in front of them in line

(code snippets from hereon are in the context of being placed below the previous code snippets)
```Lua
--MC_FAMILIAR_UPDATE passes the familiar its updating.
function mod:FamiliarUpdate(familiar)
	familiar:FollowParent()
end

--MC_FAMILIAR_UPDATE is the UPDATE callback for familiars. It accepts an optional argument to only run for your familiar variant.
mod:AddCallback(ModCallbacks.MC_FAMILIAR_UPDATE, mod.FamiliarUpdate, FAMILIAR_VARIANT)
```

A shooter familiar is a familiar that fires tears alongside Isaac. Thankfully there is an extremely simple function that will handle the vast majority of work involved: [EntityFamiliar:Shoot](https://wofsauge.github.io/IsaacDocs/rep/EntityFamiliar.html#shoot).

```Lua
function mod:FamiliarUpdate(familiar)
	familiar:Shoot()
	familiar:FollowParent()
end

mod:AddCallback(ModCallbacks.MC_FAMILIAR_UPDATE, mod.FamiliarUpdate, FAMILIAR_VARIANT)
```

This function, when ran on `MC_FAMILIAR_UPDATE`, will make your familiar fire regular tears 1.36 times a second dealing 3.5 damage per shot. It will automatically synergize with shooter familiar modifiers such as Baby-Bender, BFFS!, and Forgotten Lullaby, and firing direction overrides like King Baby and Marked. It will also automatically handle playing the appropriate animations for a shooter familiar. You can copy/reference `003.001_brother bobby.anm2` inside the game's [extracted resources](creating_a_mod.md#extracting-the-games-resources).

If you wish to modify the firing speed and attributes of the tear, there are methods for doing so. Without REPENTOGON, you will need to some manual checks inside `MC_FAMILIAR_UPDATE`. This code will alter the firerate of the familiar so that it fires 1 tear per second, do double the normal damage, and slow enemies.

```Lua
function mod:FamiliarUpdate(familiar)
	local player = familiar.Player
	local fireDir = player:GetFireDirection()
	--We check FireCooldown before :Shoot() as we know familiars can only fire if its 0
	local canFire = familiar.FireCooldown == 0

	familiar:Shoot()

	--Checking FireCooldown, we know :Shoot() successfully fired something if FireCooldown is now above 0.
	if canFire and familiar.FireCooldown > 0 then
		--Callback runs at 30 fps and FireCooldown decreases by 1 every frame
		--30 = 1 second
		local newCooldown = 30

		--Account for Forgotten Lullaby that halves the cooldown
		if player:HasTrinket(TrinketType.TRINKET_FORGOTTEN_LULLABY) then
			--math.floor is to remove decimals and make it an integer instead of a float
			newCooldown = math.floor(familiar.FireCooldown / 2)
		end

		--Set new cooldown
		familiar.FireCooldown = newCooldown

		--:Shoot() will already have spawned the tear and made tear effects/damage modifiers, so we can search for it and make modifications here.
		--MC_POST_TEAR_INIT can be used, but tear effects/damage is overridden afterwards
		for _, ent in ipairs(Isaac.FindByType(EntityType.ENTITY_TEAR, TearVariant.BLUE, 0)) do
			--Check its only from our familiar by checking the Type and Variant of what spawned it
			if ent.SpawnerType == EntityType.ENTITY_FAMILIAR
				and ent.SpawnerVariant == FAMILIAR_VARIANT
				--Check that it just spawned
				and tear.FrameCount == 0
			then
				--Isaac.FindByType always passes an Entity object. Make it an EntityFamiliar to access :AddTearFlags()
				local tear = ent:ToTear()
				--Add tear modifiers
				tear:AddTearFlags(TearFlags.TEAR_SLOW)
				tear.CollisionDamage = tear.CollisionDamage * 2
			end
		end
	end

	familiar:FollowParent()
end

mod:AddCallback(ModCallbacks.MC_FAMILIAR_UPDATE, mod.FamiliarUpdate, FAMILIAR_VARIANT)
```

If instead using :modding-repentogon: REPENTOGON, there is a callback named [MC_POST_FAMILIAR_FIRE_PROJECTILE](https://repentogon.com/enums/ModCallbacks.html#mc_post_familiar_fire_projectile) that triggers when `EntityFamiliar:Shoot` is called and a tear is fired.

```Lua
--Callback only passes the fired tear
function mod:FamiliarShoot(tear)
	local familiar = tear.SpawnerEntity and tear.SpawnerEntity:ToFamiliar()
	local newCooldown = 30

	if player:HasTrinket(TrinketType.TRINKET_FORGOTTEN_LULLABY) then
		newCooldown = math.floor(familiar.FireCooldown / 2)
	end

	familiar.FireCooldown = newCooldown
	tear:AddTearFlags(TearFlags.TEAR_SLOW)
	tear.CollisionDamage = tear.CollisionDamage * 2
end

--Callback accepts an optional argument to only run for your familiar variant.
mod:AddCallback(ModCallbacks.MC_POST_FAMILIAR_FIRE_PROJECTILE, mod.FamiliarShoot, FAMILIAR_VARIANT)
```